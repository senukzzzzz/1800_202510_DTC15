<!-- Main HTML file for the news application -->
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags for proper rendering and viewport settings -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slap News - Your 10-Minute News Digest</title>

    <!-- Google Fonts - Inter for body text and Poppins for headings -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@700&display=swap"
        rel="stylesheet">

    <!-- Application stylesheets -->
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/main-styles.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Firebase SDK and Authentication -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="./scripts/firebaseAPI_DTC15.js"></script>
    <script src="./scripts/authentication.js"></script>
    <script src="./scripts/theme.js"></script>
</head>

<body>
    <!-- Header Section - Contains navigation and search -->
    <header>
        <nav class="navbar">
            <div class="navbar-container">
                <!-- Logo Section -->
                <div class="logo-container">
                    <div class="logo">
                        <div class="logo-wrapper">
                            <span class="logo-text">SLAP</span>
                            <span class="logo-divider"></span>
                            <span class="logo-news">NEWS</span>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Toggle Button - Only visible on small screens -->
                <button id="mobileMenuToggle" class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Desktop Navigation Links -->
                <div class="desktop-nav">
                    <a href="#" class="desktop-nav-item active">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                    <a href="categories.html" class="desktop-nav-item">
                        <i class="fas fa-th-large"></i>
                        <span>Categories</span>
                    </a>
                    <a href="bookmarks.html" class="desktop-nav-item">
                        <i class="fas fa-bookmark"></i>
                        <span>Bookmarks</span>
                    </a>
                </div>

                <!-- Navigation Actions (Search and Profile) -->
                <div class="nav-actions">
                    <!-- Search Bar -->
                    <div class="search-bar">
                        <div class="search-icon-wrapper">
                            <i class="fas fa-search"></i>
                        </div>
                        <input type="search" placeholder="Search articles...">
                        <div class="search-divider"></div>
                        <button class="filter-btn">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                    </div>

                    <!-- Profile Button and Dropdown -->
                    <div class="profile-container">
                        <button class="profile-btn" id="profileBtn">
                            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=80&h=80&fit=crop"
                                alt="Profile" class="profile-img">
                        </button>
                        <div class="dropdown-menu" id="dropdownMenu">
                            <a href="settings.html" class="dropdown-item">
                                <i class="fas fa-cog"></i>
                                Settings
                            </a>
                            <a href="profile.html" class="dropdown-item">
                                <i class="fas fa-user"></i>
                                Profile
                            </a>
                            <a href="#" class="dropdown-item" id="signOutBtn">
                                <i class="fas fa-sign-out-alt"></i>
                                Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Navigation Menu - Hidden by default -->
        <div id="mobileMenu" class="mobile-menu">
            <div class="mobile-nav-items">
                <a href="#" class="mobile-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="categories.html" class="mobile-nav-item">
                    <i class="fas fa-th-large"></i>
                    <span>Categories</span>
                </a>
                <a href="bookmarks.html" class="mobile-nav-item">
                    <i class="fas fa-bookmark"></i>
                    <span>Bookmarks</span>
                </a>
            </div>
            <!-- Mobile Search Bar -->
            <div class="mobile-search">
                <div class="search-bar-mobile">
                    <i class="fas fa-search"></i>
                    <input type="search" placeholder="Search articles...">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="main-content">
        <!-- Quick Stats Section - Shows user activity summary -->
        <div class="quick-stats">
            <div class="stat-card">
                <span class="stat-number">10</span>
                <span class="stat-label">Minutes Daily Digest</span>
            </div>
            <div class="stat-card">
                <span class="catagory-number">5</span>
                <span class="stat-label">Your Categories</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">15</span>
                <span class="stat-label">Saved Articles</span>
            </div>
        </div>

        <!-- News Feed Section -->
        <div class="news-feed">
            <!-- Featured News Article - Larger display -->
            <article class="news-card featured">
                <div class="news-content">
                    <h2>Luka Doncic Gets Traded to the Lakers</h2>
                    <p>In one of the most stunning trades ever reported, the NBA landscape has been altered mightily in
                        a blink of an eye...</p>
                    <div class="news-meta">
                        <span class="time">Just Now</span>
                        <div class="actions">
                            <!-- Bookmark and Share buttons -->
                            <button class="bookmark-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z" />
                                </svg>
                            </button>
                            <button class="share-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path
                                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="news-image">
                    <img src="https://images.unsplash.com/photo-1546519638-68e109498ffc?w=800&h=600&fit=crop"
                        alt="Basketball game">
                </div>
            </article>

            <!-- Regular News Cards Grid -->
            <div class="news-grid">
                <!-- Technology News Card -->
                <article class="news-card">
                    <span class="category-tag">Technology</span>
                    <h3>Apple Announces Revolutionary AI Features</h3>
                    <p>New iOS update brings groundbreaking AI capabilities to all users...</p>
                    <div class="news-meta">
                        <span class="time">2h ago</span>
                        <div class="actions">
                            <button class="bookmark-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z" />
                                </svg>
                            </button>
                            <button class="share-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path
                                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </article>

                <!-- Sports News Card -->
                <article class="news-card">
                    <span class="category-tag">Sports</span>
                    <h3>Champions League Quarter-Finals Set</h3>
                    <p>Draw reveals exciting matchups for the next round...</p>
                    <div class="news-meta">
                        <span class="time">3h ago</span>
                        <div class="actions">
                            <button class="bookmark-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z" />
                                </svg>
                            </button>
                            <button class="share-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path
                                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92zM18 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM6 13c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm12 7.02c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </main>

    <!-- Category Selection Popup -->
    <div id="categoryPopup" class="category-popup">
        <div class="category-popup-content">
            <div class="category-popup-header">
                <h2>Personalize Your News Feed</h2>
                <p>Select categories you're interested in to get started</p>
            </div>
            <div class="category-grid">
                <div class="category-item">
                    <input type="checkbox" id="category-technology" class="category-checkbox"
                        onclick="event.stopPropagation();">
                    <label for="category-technology" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <span>Technology</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-sports" class="category-checkbox">
                    <label for="category-sports" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-basketball-ball"></i>
                        </div>
                        <span>Sports</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-business" class="category-checkbox">
                    <label for="category-business" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span>Business</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-politics" class="category-checkbox">
                    <label for="category-politics" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-landmark"></i>
                        </div>
                        <span>Politics</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-entertainment" class="category-checkbox">
                    <label for="category-entertainment" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-film"></i>
                        </div>
                        <span>Entertainment</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-science" class="category-checkbox">
                    <label for="category-science" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-atom"></i>
                        </div>
                        <span>Science</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-health" class="category-checkbox">
                    <label for="category-health" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <span>Health</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-travel" class="category-checkbox">
                    <label for="category-travel" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-plane"></i>
                        </div>
                        <span>Travel</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-food" class="category-checkbox">
                    <label for="category-food" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <span>Food</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-fashion" class="category-checkbox">
                    <label for="category-fashion" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-tshirt"></i>
                        </div>
                        <span>Fashion</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-climate" class="category-checkbox">
                    <label for="category-climate" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <span>Climate</span>
                    </label>
                </div>
                <div class="category-item">
                    <input type="checkbox" id="category-gaming" class="category-checkbox">
                    <label for="category-gaming" class="category-label">
                        <div class="category-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <span>Gaming</span>
                    </label>
                </div>
            </div>
            <div class="category-popup-footer">
                <button id="skipCategories" class="skip-button">Remind Me Later</button>
                <button id="saveCategories" class="save-button">Get Started</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const categoryPopup = document.getElementById('categoryPopup');
            const saveCategories = document.getElementById('saveCategories');
            const skipCategories = document.getElementById('skipCategories');

            // Prevent default click behavior on category labels
            document.querySelectorAll('.category-label').forEach(label => {
                label.addEventListener('click', function (e) {
                    // Only toggle the checkbox state, don't propagate the event further
                    e.preventDefault();
                    const checkbox = document.getElementById(this.getAttribute('for'));
                    checkbox.checked = !checkbox.checked;
                    e.stopPropagation();
                });
            });

            // Check if user is logged in and if they've seen the popup before
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    // User is logged in, check if they've seen the popup before
                    const db = firebase.firestore();

                    db.collection('Users').doc(user.uid).get()
                        .then((doc) => {
                            // If the document doesn't exist or hasSeenCategoryPopup is false or undefined, show popup
                            if (!doc.exists || !doc.data().hasSeenCategoryPopup) {
                                // Show the popup
                                categoryPopup.classList.add('show');
                                document.body.classList.add('popup-open');

                                // Pre-select checkboxes if user has previously selected categories
                                if (doc.exists && doc.data().categories) {
                                    const userCategories = doc.data().categories;
                                    userCategories.forEach(category => {
                                        const checkbox = document.getElementById(`category-${category}`);
                                        if (checkbox) checkbox.checked = true;
                                    });
                                }
                            } else {
                                // User has seen popup before, just load their categories if available
                                if (doc.data().categories) {
                                    updateCategoriesDisplay(doc.data().categories);
                                }
                            }
                        })
                        .catch(error => {
                            console.error("Error checking user preferences:", error);
                        });
                } else {
                    // User is not logged in, check localStorage
                    const hasVisited = localStorage.getItem('hasVisitedBefore');

                    if (!hasVisited) {
                        categoryPopup.classList.add('show');
                        document.body.classList.add('popup-open');
                    } else {
                        // Load saved categories from localStorage
                        const savedCategories = localStorage.getItem('userCategories');
                        if (savedCategories) {
                            updateCategoriesDisplay(JSON.parse(savedCategories));
                        }
                    }
                }
            });

            // Save category preferences and close popup
            saveCategories.addEventListener('click', function () {
                const selectedCategories = [];
                document.querySelectorAll('.category-checkbox:checked').forEach(checkbox => {
                    selectedCategories.push(checkbox.id.replace('category-', ''));
                });

                // Save the selected categories to local storage
                localStorage.setItem('userCategories', JSON.stringify(selectedCategories));
                localStorage.setItem('hasVisitedBefore', 'true');

                // Also save to Firebase if user is authenticated
                saveCategoriesToFirebase(selectedCategories);

                // Close the popup with animation
                categoryPopup.classList.add('hide');
                setTimeout(() => {
                    categoryPopup.classList.remove('show', 'hide');
                    document.body.classList.remove('popup-open');
                }, 300);

                // Update the UI based on selected categories
                updateCategoriesDisplay(selectedCategories);
            });

            // Function to save categories to Firebase
            function saveCategoriesToFirebase(categories) {
                // Check if user is logged in
                firebase.auth().onAuthStateChanged(user => {
                    if (user) {
                        // User is signed in, get reference to Firestore
                        const db = firebase.firestore();

                        // Save categories directly to the Users collection
                        db.collection('Users').doc(user.uid).update({
                            categories: categories,
                            hasSeenCategoryPopup: true, // Mark that user has seen the popup
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        })
                            .then(() => {
                                console.log("Categories saved to Users collection");
                            })
                            .catch((error) => {
                                console.error("Error saving categories:", error);
                            });
                    } else {
                        // User is not signed in, we already saved to localStorage
                        console.log("User not signed in, preferences saved only locally");
                    }
                });
            }

            // Skip category selection for now
            skipCategories.addEventListener('click', function () {
                localStorage.setItem('hasVisitedBefore', 'true');

                // If user is logged in, mark that they've seen the popup
                firebase.auth().onAuthStateChanged(user => {
                    if (user) {
                        const db = firebase.firestore();
                        db.collection('Users').doc(user.uid).update({
                            hasSeenCategoryPopup: true,
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                });

                // Close the popup with animation
                categoryPopup.classList.add('hide');
                setTimeout(() => {
                    categoryPopup.classList.remove('show', 'hide');
                    document.body.classList.remove('popup-open');
                }, 300);
            });

            // Update the categories display based on user selection
            function updateCategoriesDisplay(categories) {
                // This would update the UI to show only the selected categories
                // For now, we'll just log them
                console.log('Selected categories:', categories);

                // Update the stat card for categories
                const categoryCount = document.querySelector('.catagory-number');
                if (categoryCount && categories.length > 0) {
                    categoryCount.textContent = categories.length;
                }
            }

            // Mobile menu toggle
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function () {
                    // Toggle mobile menu with animation
                    if (mobileMenu.style.display === 'block') {
                        // Hide menu with fade-out animation
                        mobileMenu.style.opacity = '0';
                        mobileMenu.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            mobileMenu.style.display = 'none';
                        }, 300);
                    } else {
                        // Show menu with fade-in animation
                        mobileMenu.style.display = 'block';
                        setTimeout(() => {
                            mobileMenu.style.opacity = '1';
                            mobileMenu.style.transform = 'translateY(0)';
                        }, 10);
                    }
                });
            }
        });
    </script>

    <style>
        /* Category Popup Styles */
        .category-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .category-popup.show {
            opacity: 1;
            visibility: visible;
        }

        .category-popup.hide {
            opacity: 0;
            transform: scale(0.95);
        }

        .category-popup-content {
            background: var(--nav-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border);
            backdrop-filter: blur(20px);
            max-height: 90vh;
            overflow-y: auto;
        }

        .category-popup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .category-popup-header h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .category-popup-header p {
            color: var(--text-color-secondary);
            font-size: 16px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .category-item {
            position: relative;
        }

        .category-checkbox {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .category-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 20px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            height: 100%;
        }

        .category-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: var(--search-bg);
            border-radius: 50%;
            margin-bottom: 12px;
            font-size: 24px;
            color: var(--accent-color);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .category-checkbox:checked+.category-label {
            background: var(--accent-bg);
            border-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 114, 255, 0.2);
        }

        .category-checkbox:checked+.category-label .category-icon {
            background: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }

        .category-label span {
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .category-checkbox:checked+.category-label span {
            color: var(--accent-color);
            font-weight: 600;
        }

        .category-popup-footer {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
        }

        .skip-button {
            background: var(--search-bg);
            color: var(--text-color-secondary);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .skip-button:hover {
            background: var(--hover-bg);
            color: var(--text-color);
        }

        .save-button {
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 2;
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3);
        }

        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 114, 255, 0.4);
        }

        body.popup-open {
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 12px;
            }

            .category-icon {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }

            .category-popup-header h2 {
                font-size: 24px;
            }

            .category-popup-content {
                padding: 20px;
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .category-popup-footer {
                flex-direction: column;
            }

            .skip-button,
            .save-button {
                width: 100%;
            }
        }

        .bookmark-btn.active .icon {
            fill: #0072ff !important;
        }

        .bookmark-btn.active {
            color: #0072ff !important;
        }
    </style>

    <script src="./scripts/profile.js"></script>
    <script src="./scripts/bookmarkUtils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set up bookmark buttons
            setupBookmarks();

            function setupBookmarks() {
                // Get all bookmark buttons
                const buttons = document.querySelectorAll('.bookmark-btn');

                buttons.forEach(btn => {
                    const article = btn.closest('.news-card');
                    // Use a consistent ID pattern with the article title as a slug
                    const title = article.querySelector('h2, h3').textContent;
                    const id = article.dataset.id || 'article_' + title.toLowerCase().replace(/[^a-z0-9]+/g, '_').slice(0, 30);

                    // Set ID if it doesn't exist
                    if (!article.dataset.id) {
                        article.dataset.id = id;
                    }

                    // IMPORTANT: Check if already bookmarked and set active state
                    if (bookmarkStore.isBookmarked(id)) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }

                    // Handle bookmark toggle with improved logic
                    btn.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();

                        // Get updated article data
                        const articleData = {
                            id: id,
                            title: article.querySelector('h2, h3').textContent,
                            description: article.querySelector('p').textContent,
                            image: article.querySelector('img')?.src || '',
                            category: article.querySelector('.category-tag')?.textContent || 'General'
                        };

                        // Toggle bookmark state
                        const result = bookmarkStore.toggleBookmark(articleData);

                        // Update button state based on result
                        if (result.action === 'added' && result.success) {
                            btn.classList.add('active');
                        } else if (result.action === 'removed' && result.success) {
                            btn.classList.remove('active');
                        }
                    });
                });

                // Update the bookmark count in the stats section
                updateBookmarkCount();
            }

            // Update the bookmark count in stats
            function updateBookmarkCount() {
                const bookmarkCount = document.querySelector('.stat-number:last-child');
                if (bookmarkCount) {
                    const count = bookmarkStore.getBookmarks().length;
                    bookmarkCount.textContent = count;
                }
            }
        });
    </script>
</body>

</html>